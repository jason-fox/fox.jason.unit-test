language: java
sudo: required
dist: bionic

jdk:
  - openjdk10

addons:
  apt:
    packages:
      - ant
  sonarcloud:
    organization: "dita-ot-plugins"
    token:
      secure: "Czsiu8Rw6rd65jdkCeTG+gGyMhxb9gqoupTsv7D6qb0kN+jH45PhbUBcszQk7d3/WU5aO+SVghRD1bY/pHKAAZGJS5lOH2zvXJ9M+AF29kd8A2y4KPOurrZP+bQ/gluLeNXCbC9t9s+qFNaOUWYYAGmK/cqWjvNLnkKw6WosWI1AlyvDF0JOFDOKKfJ2NzWCHElWZn7wqC0UdZIikZen4Vpu3FKsb60QideLcJWbQsnyG/pSQ1eM1VNo4fKPiQlY3rInovz9YHiiNi4brDCXIZ1pWqOwIQleAEvS/fHjsPf8lZZZellDGIswVcEx09l2c+sn+oVdv/8CdgvrwMmGzfsldyu+On8fkllvTnSIlnxDdi9lTe33GxmKzj7iwl9PL9DdCgW5DrOQT9sFsmFLXtIKK/vdH8bCBP+4KsbPsufwK3M3oLjVCmTkRV/Gn7ln+beM8GphUuGdP50wdca9rVB/6BOFBP6i6zYCkuOLiLWq1FNPsKflASwBGxZx06VsKmCv4Ub7dWQXminCCE+uE6u5aNS914Y3Dlanr70FgpYSi1htpa9yidn5jh78GsdtMogKB0MJevxzAbnqfFtiwiGXJD69DsgnPUidSYEnrYzhLmz1esT04YqmcPxYRfvS1mO/Fl6bI95ILIlt204eYpd1BchBpnzwPE5P5Zqc1RA="

before_install:
  - zip -r fox.jason.unit-test.zip . -x *.zip* *.git/* *temp/* *out/*
  - curl -LO https://github.com/dita-ot/dita-ot/releases/download/$DITA_OT/dita-ot-$DITA_OT.zip
  - unzip -q dita-ot-$DITA_OT.zip
  - chmod +x dita-ot-$DITA_OT/bin/dita

install:
  - dita-ot-$DITA_OT/bin/dita --install https://github.com/jason-fox/com.here.validate.svrl/archive/v2.0.2.zip
  - dita-ot-$DITA_OT/bin/dita --install https://github.com/jason-fox/com.here.validate.svrl.text-rules/archive/v2.0.2.zip
  - dita-ot-$DITA_OT/bin/dita --install fox.jason.unit-test.zip
  

script:
  - dita-ot-$DITA_OT/bin/dita --input dita-ot-$DITA_OT/plugins/fox.jason.unit-test -f unit-test --output . -v

jobs:
  include:
    - stage: test
      name: "Unit Tests: DITA_OT=3.3.4"
      env: DITA_OT=3.3.4

      before_script:
        - dita-ot-$DITA_OT/bin/dita --input dita-ot-$DITA_OT/plugins/fox.jason.unit-test -f xsl-instrument

      after_success:
        - cp dita-ot-$DITA_OT/plugins/fox.jason.unit-test/resource/pom.xml pom.xml
        - mvn clean org.eluder.coveralls:coveralls-maven-plugin:report
        - rm -rf dita-ot-$DITA_OT
        - sonar-scanner

    - stage: test
      name: "Unit Tests: DITA_OT=2.5.4"
      env: DITA_OT=2.5.4
