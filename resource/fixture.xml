<?xml version="1.0"?>
<!DOCTYPE project>
<project xmlns:if="ant:if" xmlns:unless="ant:unless"  basedir="." name="unit-test.fixture">

	<description/>
	<basename property="test-suite" file="${ant.file.unit-test.fixture}/.."/>

	<!--
		Macro to run a unit-test for a given document

		@param name	- Name of the test to run
	-->
	<macrodef name="unit-test">
		<attribute name="name"/>
		<sequential>
			
			<exec executable="ant" failonerror="false" outputproperty="output" resultproperty="result" osfamily="unix">
				<arg value="-f"/>
				<arg value="${basedir}/test/@{name}/build.xml"/>
				<arg value="-S"/>
				<arg value="-q"/>
				<arg value="-Dtest.root.dir=${basedir}"/>
				<arg value="-Dtest.copy.dir=${test.copy.dir}/${test-suite}"/>
				<arg value="-Dtest.copy=${test.copy}"/>
				<arg value="-Ddita.dir=${dita.dir}"/>
				<arg value="-Dtest.colorize=false"/>
			</exec>

			<exec executable="cmd" dir="${repo.dir}" failonerror="false" outputproperty="output" resultproperty="result" osfamily="windows">
				<arg value="/C"/>
				<arg value="ant -f ${basedir}/@{name}/build.xml -S -q -Dtest.root.dir=${basedir} -Dtest.copy.dir=${test.copy.dir}/${test-suite} -Dtest.copy=${test.copy} -Ddita.dir=${dita.dir} -Dtest.colorize=false"/>
			</exec>
			<condition property="test.failed" >
        		<not>
        			<equals arg1="${result}" arg2="0"/>
        		</not>
    		</condition>
			<fail if:set="test.failed" message="${output}"/>
		</sequential>
	</macrodef>
	<!-- TESTS -->
</project>